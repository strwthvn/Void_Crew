#!/usr/bin/env bash
set -euo pipefail

# Pre-commit hook: check that staged C++ files are correctly formatted.
# Uses --dry-run --Werror (check-only) to match CI behavior.

# Collect staged C++ files (Added, Copied, Modified)
files=$(git diff --cached --name-only --diff-filter=ACM -- '*.cpp' '*.hpp')

if [ -z "$files" ]; then
    exit 0
fi

# Check formatting
failed=0
for file in $files; do
    if ! clang-format --dry-run --Werror "$file" 2>/dev/null; then
        echo "  $file"
        failed=1
    fi
done

if [ "$failed" -ne 0 ]; then
    echo ""
    echo "Fix with: clang-format -i <file>"
    exit 1
fi
