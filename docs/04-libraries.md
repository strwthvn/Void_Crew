# Библиотеки технологического стека

## Сводная таблица

| Категория | Библиотека | Версия | Лицензия | Назначение |
|-----------|------------|--------|----------|------------|
| **Сеть** |||||
| | GameNetworkingSockets | 1.4+ | BSD-3 | Надёжный UDP, шифрование, NAT traversal |
| | Opus | 1.4+ | BSD-3 | Кодек голосовой связи |
| | libcurl | 8.0+ | MIT | HTTP для мастер-сервера и обновлений |
| **Графика** |||||
| | Vulkan SDK | 1.3+ | Apache 2.0 | Графический API |
| | SDL2 | 2.28+ | zlib | Окна, ввод, контекст |
| | VMA | 3.0+ | MIT | Управление памятью Vulkan |
| | stb_image | 2.28+ | Public Domain | Загрузка текстур |
| | Dear ImGui | 1.89+ | MIT | Отладочный UI и инструменты |
| **Аудио** |||||
| | miniaudio | 0.11+ | Public Domain | Кроссплатформенный вывод звука |
| | Steam Audio | 4.0+ | Проприетарная (бесплатная) | HRTF, окклюзия, реверберация |
| **ECS и архитектура** |||||
| | EnTT | 3.12+ | MIT | Entity Component System |
| | eventpp | 0.1+ | Apache 2.0 | События и сигналы |
| **Сериализация** |||||
| | FlatBuffers | 23.0+ | Apache 2.0 | Бинарный протокол, сохранения |
| | nlohmann/json | 3.11+ | MIT | Конфигурации, данные |
| | toml++ | 3.3+ | MIT | Настройки пользователя |
| **Математика и физика** |||||
| | GLM | 0.9.9+ | MIT | Векторы, матрицы, кватернионы |
| | Jolt Physics | 4.0+ | MIT | Физический движок |
| **Навигация** |||||
| | Recast/Detour | 1.6+ | zlib | Навигационная сетка и pathfinding |
| **Многопоточность** |||||
| | taskflow | 3.6+ | MIT | Параллельные задачи и граф зависимостей |
| | concurrentqueue | 1.0+ | BSD-2 | Lock-free очереди |
| **Утилиты** |||||
| | spdlog | 1.12+ | MIT | Логирование |
| | fmt | 10.0+ | MIT | Форматирование строк |
| | xxHash | 0.8+ | BSD-2 | Быстрое хеширование |
| | lz4 | 1.9+ | BSD-2 | Сжатие данных |
| **Генерация** |||||
| | FastNoise2 | 0.10+ | MIT | Процедурный шум |
| | PCG | — | Apache 2.0 | Генератор случайных чисел |
| **Скриптинг (опционально)** |||||
| | Lua | 5.4+ | MIT | Скрипты событий и модификации |
| | sol2 | 3.3+ | MIT | C++ биндинги для Lua |
| **Тестирование** |||||
| | Catch2 | 3.4+ | BSL-1.0 | Модульные тесты |
| | Tracy | 0.10+ | BSD-3 | Профилирование |
| **Сборка** |||||
| | CMake | 3.25+ | BSD-3 | Система сборки |
| | vcpkg | — | MIT | Пакетный менеджер |

---

## Детали по категориям

### Сеть

**GameNetworkingSockets** — библиотека Valve для игровой сети. Обеспечивает надёжную и ненадёжную доставку поверх UDP, встроенное шифрование, поддержку relay-серверов. Используется как для игрового трафика, так и для голоса.

**Opus** — стандартный кодек для голосовой связи в реальном времени. Настраиваемый битрейт, низкая задержка, хорошее качество даже при потерях пакетов.

**libcurl** — связь с мастер-сервером для списка игр, проверки обновлений, отправки аналитики. Не используется для игрового трафика.

### Графика

**Vulkan SDK** — низкоуровневый графический API. Включает заголовки, загрузчик, валидационные слои для отладки. На macOS работает через MoltenVK.

**SDL2** — создание окна, обработка ввода, управление контекстом Vulkan. Кроссплатформенный, проверенный временем.

**VMA (Vulkan Memory Allocator)** — упрощает управление памятью GPU. Автоматический выбор типа памяти, дефрагментация, отладочные инструменты.

**stb_image** — однофайловая библиотека загрузки изображений. Поддержка PNG, JPEG, TGA, BMP. Достаточно для загрузки текстур.

**Dear ImGui** — immediate mode GUI для отладочных инструментов, редактора, инспекторов. Не для игрового интерфейса — там собственное решение.

### Аудио

**miniaudio** — единый API для аудио-вывода на всех платформах. Однофайловая, без зависимостей. Базовое микширование и эффекты.

**Steam Audio** — продвинутая пространственная обработка. HRTF для точного позиционирования в наушниках, физически корректная окклюзия через стены, автоматическая реверберация помещений.

### ECS и архитектура

**EnTT** — быстрая header-only реализация Entity Component System. Минимальное влияние на время компиляции, хорошая документация, активное развитие.

**eventpp** — типобезопасная система событий. Для связи между подсистемами без жёстких зависимостей.

### Сериализация

**FlatBuffers** — бинарная сериализация от Google. Нулевое копирование при чтении, схема с версионированием. Используется для сетевого протокола и сохранений.

**nlohmann/json** — удобный JSON для C++. Для конфигурационных файлов, определений предметов и существ, данных, которые редактируются вручную.

**toml++** — парсер TOML для пользовательских настроек. Более читаемый формат для конфигов, чем JSON.

### Математика и физика

**GLM** — математическая библиотека в стиле GLSL. Векторы, матрицы, кватернионы, геометрические функции. Стандарт де-факто для графических приложений на C++.

**Jolt Physics** — современный физический движок. Разработан для игр, хорошая производительность, активно развивается. Для коллизий, ragdoll, взаимодействия объектов.

### Навигация

**Recast/Detour** — генерация навигационных сеток и поиск пути. Recast строит navmesh из геометрии, Detour обеспечивает pathfinding. Индустриальный стандарт.

### Многопоточность

**taskflow** — граф задач с автоматическим распараллеливанием. Удобнее, чем ручное управление потоками. Для распределения нагрузки между ядрами.

**concurrentqueue** — lock-free очередь для передачи данных между потоками. Используется для команд от сетевого потока к игровому.

### Утилиты

**spdlog** — быстрое логирование с поддержкой асинхронного режима. Минимальное влияние на производительность в release-сборках.

**fmt** — форматирование строк. Основа spdlog, но полезна и сама по себе. Безопаснее и быстрее printf.

**xxHash** — быстрый некриптографический хеш. Для таблиц, проверки целостности данных, идентификации ресурсов.

**lz4** — быстрое сжатие. Для снимков состояния, сохранений, сетевых пакетов. Приоритет скорости над степенью сжатия.

### Генерация

**FastNoise2** — библиотека процедурного шума с SIMD-оптимизацией. Для генерации ландшафта, размещения ресурсов, вариаций текстур.

**PCG** — качественный генератор псевдослучайных чисел. Лучше стандартного rand(), воспроизводимость по seed для процедурной генерации.

### Скриптинг

**Lua** — лёгкий встраиваемый язык. Для скриптов событий, поведения ГМ, модификаций. Опционален — базовая функциональность работает без скриптов.

**sol2** — современные C++ биндинги для Lua. Упрощает интеграцию, типобезопасность, автоматическое преобразование типов.

### Тестирование

**Catch2** — современный фреймворк модульного тестирования. BDD-стиль, удобные макросы, хорошие сообщения об ошибках.

**Tracy** — профилировщик реального времени. Низкие накладные расходы, визуализация в отдельном приложении, поддержка GPU-профилирования.

---

## Альтернативы

| Основной выбор | Альтернатива | Причина замены |
|----------------|--------------|----------------|
| GameNetworkingSockets | ENet | Если не нужно шифрование и relay |
| EnTT | flecs | Если нужны встроенные связи и иерархии |
| miniaudio | OpenAL Soft | Если нужен более богатый API |
| Steam Audio | Resonance Audio | Открытая альтернатива от Google |
| Jolt Physics | Bullet | Если нужна проверенная временем стабильность |
| FlatBuffers | Cap'n Proto | Если нужен RPC из коробки |
| nlohmann/json | simdjson | Если критична скорость парсинга |
| Lua | Wren | Если нужен более современный синтаксис |
| Catch2 | GoogleTest | Если команда привыкла к gtest |

---

## Матрица использования

| Библиотека | Сервер | Клиент | Общий код | Инструменты |
|------------|:------:|:------:|:---------:|:-----------:|
| GameNetworkingSockets | ✓ | ✓ | | |
| Opus | ✓ | ✓ | | |
| Vulkan SDK | | ✓ | | ✓ |
| SDL2 | | ✓ | | ✓ |
| miniaudio | | ✓ | | |
| Steam Audio | | ✓ | | |
| EnTT | ✓ | ✓ | ✓ | |
| FlatBuffers | ✓ | ✓ | ✓ | |
| GLM | ✓ | ✓ | ✓ | ✓ |
| Jolt Physics | ✓ | | | |
| Recast/Detour | ✓ | | | ✓ |
| taskflow | ✓ | ✓ | | |
| spdlog | ✓ | ✓ | ✓ | ✓ |
| FastNoise2 | ✓ | | | ✓ |
| Lua | ✓ | | | |
| Tracy | ✓ | ✓ | | ✓ |
| Dear ImGui | | ✓ | | ✓ |

---

## Лицензионная совместимость

Все выбранные библиотеки имеют разрешительные лицензии, совместимые с проприетарным распространением:

- **MIT, BSD, zlib, Apache 2.0** — можно использовать в коммерческих проектах без раскрытия исходного кода
- **Public Domain** — никаких ограничений
- **Steam Audio** — бесплатна для использования, но проприетарна; требует согласия с условиями Valve

Необходимо сохранять уведомления об авторских правах и лицензиях в дистрибутиве согласно требованиям каждой библиотеки.

---

## Управление зависимостями

### vcpkg

Рекомендуемый способ — использование vcpkg в режиме манифеста. Файл `vcpkg.json` в корне проекта:

```
{
  "dependencies": [
    "sdl2",
    "vulkan",
    "glm",
    "entt",
    "spdlog",
    "flatbuffers",
    "nlohmann-json",
    "catch2",
    "opus",
    "lz4",
    "xxhash"
  ]
}
```

Библиотеки, отсутствующие в vcpkg (GameNetworkingSockets, Steam Audio, Tracy), подключаются как git submodules или скачиваются вручную.

### Версионирование

Версии зависимостей фиксируются в `vcpkg.json` через поле `overrides` или `builtin-baseline`. Это гарантирует воспроизводимость сборки на разных машинах и в CI.
